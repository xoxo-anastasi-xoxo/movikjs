<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>07. Fixed base. Tree with constraints. No basebone constraints. Move all.</title>
    <script src="../../build/movik.js"></script>
    <style>
        html,body{margin:0; padding:0; width:100%; height:100%;}
        body{background-color:#404040;}

        canvas{border:1px solid black; position:relative; }
        div{display:flex; width:100%; height:100%; align-items:center; justify-content:center;}
    </style>
</head>
<body>
<div>
    <canvas id="scene"></canvas>
</div>
<script>
    const {Vec2f, FabrikBone2D, Utils, FabrikChain2D, FabrikStructure2D, BoneConnectionPoint} = MovikJS;

    const st = new FabrikStructure2D();

    // ----- Vertical chain -----
    let boneLength = .5;
    const verticalChain = new FabrikChain2D();
    let basebone = new FabrikBone2D( new Vec2f(0.0, -0.9), new Vec2f(0.0, 1.0), boneLength, null, null, Utils.BLACK);

    // Note: Default basebone constraint type is NONE
    verticalChain.addBone(basebone);

    // Add two additional consecutive bones
    verticalChain.addConsecutiveConstrainedBone(new Vec2f(0.0, 1.0),  boneLength, 90.0, 90.0, Utils.BLACK);
    verticalChain.addConsecutiveConstrainedBone(new Vec2f(0.0, 1.0),  boneLength,  90.0, 90.0, Utils.BLACK);

    // Add our main chain to structure
    st.addChain(verticalChain);

    // ----- Left branch chain -----
    boneLength = .4;

    // Create the base bone and set its colour
    basebone = new FabrikBone2D( new Vec2f(), new Vec2f(-boneLength, 0.0) );
    basebone.setColour(Utils.MID_GREEN);

    // Create the chain and add the basebone to it
    const leftChain = new FabrikChain2D();
    leftChain.addBone(basebone);

    // Add consecutive constrained bones
    // Note: The base-bone is unconstrained, but these bones ARE constrained
    leftChain.addConsecutiveConstrainedBone(new Vec2f(-1, 0), boneLength, 90, 90, Utils.MID_GREEN);
    leftChain.addConsecutiveConstrainedBone(new Vec2f(-1, 0), boneLength, 90.0, 90.0, Utils.MID_GREEN);

    // Add the chain to the structure, connecting to the end of bone 0 in chain 0
    st.connectChain(leftChain, 0, 0, BoneConnectionPoint.END, true);

    // ----- Right branch chain -----

    // Create the base bone
    basebone = new FabrikBone2D( new Vec2f(), new Vec2f(boneLength, 0.0) );
    basebone.setColour(Utils.RED);

    // Create the chain and add the basebone to it
    const rightChain = new FabrikChain2D();
    rightChain.addBone(basebone);

    // Add two consecutive constrained bones to the chain
    // Note: The base-bone is unconstrained, but these bones ARE constrained
    rightChain.addConsecutiveConstrainedBone(new Vec2f(1, 0), boneLength, 60.0, 60.0, Utils.RED);
    rightChain.addConsecutiveConstrainedBone(new Vec2f(1, 0), boneLength, 60.0, 60.0, Utils.RED);

    st.connectChain(rightChain, 0, 1, BoneConnectionPoint.END, true);
</script>
<script>
    const {Scene} = MovikJS;
    const scene = new Scene('scene', 2);
    scene.init();

    const primitive = scene.addPrimitive(st);
</script>
<script>
    let isDragging = false;
    const moveHandler = (e) => {
        if (!isDragging) {
            return;
        }
        const h = window.innerHeight;
        const w = window.innerWidth;

        const x = e.clientX;
        const y = e.clientY;

        let targetX = 3 * (x - (w/2)) / (w/2);
        const targetY = -3 * (h/w) * (y - (h/2)) / (h/2);
        primitive.moveTo(0, new Vec2f(targetX, targetY));
        primitive.moveTo(1, new Vec2f(targetX, targetY));
        primitive.moveTo(2, new Vec2f(targetX, targetY));
    };

    window.addEventListener('click', (e) => {isDragging = !isDragging; moveHandler(e)});
    window.addEventListener('mousemove', moveHandler);
</script>
</body>
</html>
